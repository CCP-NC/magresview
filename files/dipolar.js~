//Updating the atom selection menu, built on the model of sel_drop_handler()

function vvleck_species_drop_handler()
{
	var el = document.getElementById("vvleck_species_drop").value;
	var dropd_atoms = document.getElementById("vvleck_atom_drop");

	var s = atom_set.atom_species[el];
	dropd_atoms.options.length = atom_set.atoms[s].length;
	for (var i = 0; i < dropd_atoms.options.length; ++i)
		dropd_atoms.options[i] = new Option(i+1, i+1);
	
	vvleck_sphere_handler();
}

//Updates the range sphere if ENTER was pressed in the radius textbox

function vvleck_r_handler(evt)
{
	//Compatibility code - see console.js for details
	var evt = window.event || evt;
	var myKey = (evt.keyCode)? evt.keyCode: evt.charCode;
	
	if (myKey == 13)
	{
		range_sphere_handler();
	}
}

function vvleck_sphere_handler()
{
	sphere_script = "ellipsoid range_sphere_choice";
	
	//A bit of jQuery magic to check whether the active tab is the "Visualization" one. It just works.

	var tab_active = $("#main_tabs").tabs("option", "active");
	var acc_active = $("#visual_accordion").accordion("option", "active");
	if($("#main_tabs ul>li a").eq(tab_active).attr('href') == "#visual_accordion" &&	//Is the Visualization tab active?
		acc_active == 3																				&&	//Is the Dipolar coupling accordion section active?
		document.getElementById("vvleck_sphere_check").checked == true)					//Is the box "Visualize range sphere" ticked?
	{
		var s_c = atom_set.atom_species[document.getElementById("vvleck_species_drop").value];
		var a_c = parseInt(document.getElementById("vvleck_atom_drop").value)-1;
		var x_c = atom_set.atoms[s_c][a_c].x;
		var y_c = atom_set.atoms[s_c][a_c].y;
		var z_c = atom_set.atoms[s_c][a_c].z;
		var r = parseFloat(document.getElementById("vvleck_r").value);
		
		sphere_script += " axes {" + r + " 0 0} {0 " + r + " 0} {0 0 " + r + "} center {" + x_c + " " + y_c + " " + z_c + "} color translucent 0.7 {200 200 200};";
	}
	else
	{
		sphere_script += " delete;";
	}
   
   Jmol.script(mainJmol, sphere_script);		
				       
}