<!DOCTYPE html  PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd" encoding="UTF-8">

<!-- MagresView v 1.0.9
by Simone Sturniolo

A JMol based web viewer for ab-initio calculated NMR parameters stored in the .magres file format.
A CCP-NC project funded by STFC and EPSRC.

Copyright 2013 Science and Technology Facilities Council
This program is distributed under the terms of the GNU General Public License (GNU GPL)
Please refer to the file COPYING for the text of the license

MagresView is built around the Java Applet version of JMol, a program by Robert Hanson distributed under the GNU Lesser General Public License (GNU LGPL)
Copy of the license can be found as a text file in the /jmol folder
-->

<html>
  <head>
	<!-- JMol applet scripts loading -->
	    
	<script src="jsmol/JSmol.min.js"></script>
	<!-- This section serves the purpose of loading jQuery, jQuery UI, and the graphic theme "Vader" -->	  		
  	
	<link href="jquery/css/vader/jquery-ui.css" rel="stylesheet">
	<script src="jquery/js/jquery-ui-1.10.0.custom.min.js"></script>
    
    <!-- jQuery is a Javascript library that allows lots of new functionalities, extending in fact the language to be more efficient and flexible.
    jQuery UI introduces lots of nice interface tweaks, allowing for the use of tabs, expanding sections, sliders, animations, and so on.
    In this project, jQuery UI is used to provide an interface as simple, efficient and pleasant as possible. Though the use of the core
    jQuery library could probably shorten the code as well, I'd rather avoid that for the sake of maintainability - so that any
    developer who wants to work with the core of the page only needs to know Javascript.
    The use of jQuery exclusive constructs is thus discouraged if not strictly necessary, and even in that case, it should preferably be
    amply commented.

	 jQuery is distributed under the MIT License. For further information refer to the headers of the jQuery source code files and to the web page http://jquery.org/license/  
	 
     -->    
	
	<!-- Version definition -->
	     
	<script type="text/javascript" >
		var magresview_version_number = "1.2.5";
	</script>    
   
	<!-- Create title -->   
   
   <script type="text/javascript">
   	document.write("<title>MagresView " + magresview_version_number + "</title>");
   </script>
    
    <style>
    
    * {
   	margin: 0px;
   	padding: 0px;
	 }
	 
	 html, body {
	  width:100%;
	  height:100%;
	  background: rgb(30, 30, 30);
	  box-sizing: border-box;
	  moz-box-sizing: border-box;
	}

    div.main {
    	position: relative;
    	height: 10%;
    	width: 100%;
    	border:	0;
  	  text-align: center;
		font-weight: bolder;
		font-size: 400%;
		color: rgb(245, 245, 235);
    }
    
    div.appdiv {
    	position: absolute;
    	top: 100%;
    	left: 0;
    	height: 800%;   
    	width: 60%;
    	border:	0;
    	font-weight: bold;
    	font-size: 20%;
    	text-align: left;
    	padding-left: 1%;
    }
    
    div.consdiv {
    	position: absolute;
    	top: 101%;
    	left: 0;
    	width: 100%;
    	height: 10%;
    	border:	0;
    	font-size: 120%; 
    	padding-left: 1%;
    }
    
    .hovered {
      background-color: rgb(40,40,40);
    }
    
    div.ctrldiv {
      position: absolute;
    	top: 100%;
    	right: 5%;
    	width: 35%;
    	border:	0;
    	font-weight: bold;
    	font-size: 20%;
    	text-align: left;
    }
    
    div.ctrl_cen {
    	position: absolute;
    	top: 100%;
    	left: 0;
    	width: 100%;
    	border:	0;
    }
    
    div.ctrl_left {
    	position: relative;
    	width: 50%;
    	border:	0;
    }
    
    div.ctrl_right {
    	position: absolute;
    	top: 0;
    	left: 100%;
    	width: 100%;
    	height: 100%;
    	border:	0;
    }
    
    div.popupdiv {
    	font-weight: normal;
    	font-size: 80%;
    	text-align: left;
    }
    
    div.titlediv {
    	height: 95%;
    	width: 98%;
    	padding-top: 0.5%;
    	margin-left: 1%;
    	margin-right: 1%;
    }
    
    div.creditdiv {
    	position: absolute;
		bottom:	3%;    
		right: 3%;
  	  	text-align: right;
		font-weight: bolder;
		font-size: 80%;
		color: rgb(245, 245, 235);
    }
    
    .switchdiv {
      
      border-radius: 15px;
      background-color: rgb(60,60,60);
      width: 90px;
      height: 30px;
      position: absolute;
    }
    
    .switch_controldiv {
      border-radius: 15px;
      background-color: rgb(242, 154, 0);
      color: rgb(30,30,30);
      width: 45px;
      height: 30px;
      line-height: 28px;
      position: relative;
      left: 45px;
      text-align: center;
      vertical-align: middle;
    }

    h3.head {
	font-weight: bold;
	font-size: inherit;
    }
    
    a.hidden {
      display: none;
    }
    
    </style>
    
    <!-- Matrix functions -->
    
    <script type="text/javascript" src="files/matrix.js"></script>

    <!-- Euler angles calculations functions -->
    
    <script type="text/javascript" src="files/euler_angles.js"></script>

	 <!-- JMol applet and controls loading -->
    
    <script type="text/javascript" src="files/app_load.js"></script>
    
    <!-- Species selection dropdown menu handling -->
    
    <script type="text/javascript" src="files/sel_drop.js"></script>

    <!-- File input handling functions -->
    
    <script type="text/javascript" src="files/input.js"></script>
    
    <!-- Console handling functions -->
    
    <script type="text/javascript" src="files/console.js"></script>

    <!-- Lattice periodic boundary conditions functions -->
   
    <script type="text/javascript" src="files/periodicity.js"></script>

    <!-- Options handling functions -->
   
    <script type="text/javascript" src="files/options.js"></script>
    
    <!-- Hovering handling functions -->
    
    <script type="text/javascript" src="files/hover.js"></script>
    
    <!-- JSON parser and stringifier, for passing values to the Python script -->

	 <script type="text/javascript" src="files/json2.js"></script>

	 <script>
		
		/* This script initializes the jQuery UI controls. The options mean:
		collapsible: true --> it is possible to close the active element in an accordion. The default is for the active element to be always open
		heighStyle: "content" --> the height of each element adapts to its content (instead of using a single value for all elements)
		autoHeight: false --> helps with preventing the appearance of scroll bars in the elements
		*/
				
  		$(function() {

    		$( "#visual_accordion" ).accordion({
      		collapsible: true,
      		heightStyle: "content",
      		autoHeight: false,
      		activate: function(event, ui) {
      			visual_accor_handler();
		}
    		});
    		
    		$( "#options_accordion" ).accordion({
      		collapsible: true,
      		heightStyle: "content",
      		autoHeight: false
    		});

		$("#main_tabs").tabs({
			activate: function(event, ui) {
				sel_file_drop_handler();
				visual_accor_handler();
				iso_drop_update();
			}
		});
		
		$("#euler_popup").dialog({autoOpen: false, modal: true, position: [0.7*winW, 0.3*winH]});
		$("#vvleck_popup").dialog({autoOpen: false, modal: true, position: [0.7*winW, 0.3*winH]});
 		  		  		
  		});  		
  		
  </script>

  </head>
  <body id="main_page_body">  
  <div id="main_div" class="main">
  
  <script type="text/javascript" >
  //The font size for the main division is estimated on the basis of the total window's size. This is the font size for the title - everything else is scaled down proportionally

  	document.getElementById("main_div").style.fontSize = Math.ceil(winH/14.0) + "px";
    
  </script>
  
  <div class="titlediv">
  <img src="images/stfc_logo.png" alt="STFC" height="70%" style="float: left; margin: 0px;">
  <span style="color: rgb(242, 154, 0); margin: 0px;">M</span>agres<span style="color: rgb(242, 154, 0)">V</span>iew
  <span style="font-size: 50%; margin: 0px;"> <script type="text/javascript">document.write(magresview_version_number);</script></span>
  <img src="images/small_epsrc.png" alt="EPSRC" height="70%" style="float:right; margin: 0px;">
  </div>
	  		<div id="main_app_div" class="appdiv">
			      <div id="jmol_div" style="position: relative"></div>
			      <div id="main_cons_div" class="consdiv">
				<br>
		  		Console:<br>
		  		<input id="jmol_console" type="text" size="95%" onkeyup="console_input(event)" autocomplete="off"></input>
			      </div>
			      <br>
			      Jmol version: &nbsp;&nbsp; <span id="j_js_switch" class="switchdiv" onclick="switch_handler(true)">
				<div class="switch_controldiv">
				  JS
				</div>
			      </span>
	  		</div>
			<div id="main_ctrl_div" class="ctrldiv">
	
					<div id="main_system_load_div">
					<h3 class="head" style="color: rgb(242, 154, 0)">Load file</h3>
					<div id="main_load_div" class="ctrl_left">
							File:<br>
							<input type="file" id="load_button" name="Browse" onchange="load_file(event)" style="text-align: right" size="15%" autocomplete="off"></input>
							<div class="ctrl_right">
								<br>
								<input type="button" id="reload_butt" value="Reload model" onclick="reload_butt_handler()"></input>
								<br><br><br>
								<input type="checkbox" id="ismol_check" autocomplete="off" onchange="ismol_check_handler()"></input> Load as molecule
							</div>
							<br><br>
	  						Lattice:<br> 
	  						x: <input id="x_lat" type="text" maxlength="2" size="2" value="1" autocomplete="off"
	  						title="Insert a value greater than 1 to visualize multiple unit cells. This will not work if the loaded file does not contain cell parameter data"></input>
	  						y: <input id="y_lat" type="text" maxlength="2" size="2" value="1" autocomplete="off"
	  						title="Insert a value greater than 1 to visualize multiple unit cells. This will not work if the loaded file does not contain cell parameter data"></input>
	  						z: <input id="z_lat" type="text" maxlength="2" size="2" value="1" autocomplete="off"
	  						title="Insert a value greater than 1 to visualize multiple unit cells. This will not work if the loaded file does not contain cell parameter data"></input>
	  						
					</div>
					</div>
					<br>
					<h3 class="head" style="color: rgb(242, 154, 0)">Selection and options</h3>
					<div>
					<div id="main_sel_div" class="ctrl_left">
							Select:<br>
							<select id="sel_drop" onchange="sel_drop_handler()">
								<option value="all">All species</option>
							</select>
							<select id="sel_atom_drop" onchange="sel_atom_drop_handler()">
								<option value="all">All atoms</option>
							</select>
							<br>
							<br>
							Last distance measured:<br>
							<span id="meas_1">N/A</span> to <span id="meas_2">N/A</span>&nbsp;=&nbsp;<span id="meas_val" style="color: rgb(242, 154, 0)">N/A</span>&nbsp;&Aring;
							<br>
							<br>
					<div id="main_check_div" class="ctrl_right">
	  						<input type="checkbox" id="halos_check" title="Turn selection halos ON/OFF" onchange="halos_check_handler()" autocomplete="off">Enable selection halos</input><br>
	  						<input type="checkbox" id="bonds_check" title="Turn bond visualization ON/OFF" onchange="bonds_check_handler()" autocomplete="off" checked>Show bonds</input><br>
	  						<input type="checkbox" id="sticks_check"  title="Switch visualization between sticks and balls and wireframe" onchange="sticks_check_handler()"autocomplete="off" checked>Show sticks and balls</input><br>
	  						<input type="checkbox" id="axes_check"  title="Turn axes and unit cell ON/OFF" onchange="axes_check_handler()" autocomplete="off" checked>Show axes and unit cell</input><br>
	  						<input type="checkbox" id="labels_check"  title="Turn atom labels ON/OFF" onchange="labels_check_handler()" autocomplete="off" disabled="disabled">Show atom labels</input>
					</div>
					</div>
					</div>
					
					<br>

					<div id="main_tabs" style="font-size: 90%">
					
					<!-- This is a jQuery TAB. It needs two things:
								1) the content of the tabs organized in different divisions identified by an id;
								2) an unordered list <ul> of links to the various divisions which constitute the tabs.
								
								The main TAB division (here aptly named main_tabs) needs to be initialized as a tab system with a jQuery script, see <head> section.
								
								-->
					
								<ul>
									<li><a href="#visual_accordion">Visualization</a></li>
									<li><a href="#iso_selection">Isotope selection</a></li>
									<li><a href="#file_gen">File generation</a></li>
									<li><a href="#options_accordion">Options</a></li>
								</ul>
														
							<div id="iso_selection">
							<div id="main_el_div" class="ctrl_left">
					  					<script type="text/javascript" src="files/iso_sel.js"></script>
					  					Choose the isotope for the currently selected atom or group of atoms. If the atoms selected are not all the same element, the menu will be inactive.
							<div id="main_iso_div" class="ctrl_right">					
										Isotope: <select id="iso_drop" title="Isotope list for the current element. Default is the most abundant NMR active isotope for the element" onchange = "iso_drop_handler(event)">
											<option value="def">Current</option>								
											<option value="inac">Default</option>								
										</select>
							</div>
							</div>
							<br>
							<br>
							</div>						
																					
							<div id="visual_accordion">
							
							<!-- This is a jQuery ACCORDION. It needs:
									1) the content of the various elements organized in different divisions;
									2) an header <h3> before every division that we want to be an element.
											
									The main ACCORDION division (visual_accordion, etc.) needs to be initialized as an accordion with a jQuery script, see <head> section.
									
									-->

							<h3 id="ms_head" class="head">Visualize magnetic shielding (symmetric component)</h3>					
							<div>
							<script type="text/javascript" src="files/ms.js"></script>
							<div id="ms_ell_div" class="ctrl_left">
											
											<br>
											<input type="checkbox" id="ms_check"
											title="Ellipsoids oriented along the principal axes, with the three dimensions a, b, c proportional to the absolute value of the magnetic shielding eigenvalues."
											onchange="ms_plot_handler(event)" autocomplete="off" disabled="disabled">Ellipsoids</input>
											<br>
											Scale (0 = auto): <input type="text" id="ms_ell_scale" maxlength="5" size="3" autocomplete="off" disabled="disabled" onkeypress="ms_ell_scale_handler(event)" value="0"></input> 
											<br><br>
											<br>
											<br>
											<br>
		
							<div id="ms_label_div" class="ctrl_right">
		
											<input type="checkbox" id="ms_check_2"
											title="Visualize numerical values for quantities identifying the shielding tensor. Eigenvalue ordering is |s_3-s_iso|>|s_1-s_iso|>|s_2-s_iso|."
											onchange="ms_label_handler(event)" autocomplete="off" disabled="disabled">
											Labels</input>
		
					  						<input type="checkbox" id="ms_check_3"
					  						title="Color scale goes from blue to red, respectively most positive and most negative value."
					  						onchange="ms_color_handler(event)" autocomplete="off" disabled="disabled">
					  						Color scale</input>
		
											<form id="ms_label_type">
												&nbsp <input type="radio" name="ms_ltype" id="ms_ltype_1"
												title="Isotropic component, defined as (s_1+s_2+s_3)/3"
												value="0" autocomplete="off" onclick="ms_radio_handler(event)" disabled="disabled" checked>Isotropic component, absolute (<span style="color: rgb(255, 128, 0)">ppm</span>)</input> <br> 
												&nbsp <input type="radio" name="ms_ltype" id="ms_ltype_shield"
												title="Isotropic component (see above) subtracted from a reference shielding value"
												value="shield" autocomplete="off" onclick="ms_radio_handler(event)" disabled="disabled">Isotropic component, with shielding
												<input type="text" id="ms_shield_ref" size="3" value="0" onkeypress="ms_shield_ref_handler(event)" autocomplete="off" disabled="disabled"></input> (<span style="color: rgb(255, 128, 0)">ppm</span>) </input> <br> 
												&nbsp <input type="radio" name="ms_ltype" id="ms_ltype_2"
												title="Anisotropy, defined as s_3-(s_1+s_2)/2"
												value="1" autocomplete="off" onclick="ms_radio_handler(event)" disabled="disabled"><span id="ms_par_1">Anisotropy</span> (<span style="color: rgb(255, 128, 0)">ppm</span>)</input> <br>
												&nbsp <input type="radio" name="ms_ltype" id="ms_ltype_3"
												title="Asymmetry, defined as (s_2-s_1)/(s_3-s_iso)" 
												value="2" autocomplete="off" onclick="ms_radio_handler(event)" disabled="disabled"><span id="ms_par_2">Asymmetry</span> </input> <br>
											</form>
								</div>
								</div>
								</div>
		
								<h3  id="efg_head" class="head">Visualize electric field gradient</h3>					
								<div>
								<script type="text/javascript" src="files/efg.js"></script>
								Component: 
								<select id="efg_drop" onchange="efg_drop_handler(event)" disabled="disabled">
					  				<option value="efg">EFG</option>
					  			</select>
					  			
					  			<div id="efg_ell_div" class="ctrl_left">
								
											<br>
											<input type="checkbox" id="efg_check"
					  						title="Ellipsoids oriented along the principal axes, with the three dimensions a, b, c proportional to the absolute value of the electric field gradient eigenvalues. Scale is arbitrary and optimized for better visualization."
					  						onchange="efg_plot_handler(event)" autocomplete="off" disabled="disabled">Ellipsoids</input>
					  						<br>Scale (0 = auto): <input type="text" id="efg_ell_scale" maxlength="5" size="3" autocomplete="off" disabled="disabled" onkeypress="efg_ell_scale_handler(event)" value="0"></input> 
											<br><br>
											<br>
			  						
					  			<div id="efg_label_div" class="ctrl_right">
		
					  						<input type="checkbox" id="efg_check_2" 
					  						title="Visualize numerical values for quantities identifying the electric field gradient tensor. Eigenvalue ordering is |Vzz|>|Vxx|>|Vyy|."
					  						onchange="efg_label_handler(event)" autocomplete="off" disabled="disabled">
					  						Labels</input>
		
					  						<input type="checkbox" id="efg_check_3"
					  						title="Color scale goes from blue to red, respectively most positive and most negative value."
					  						onchange="efg_color_handler(event)" autocomplete="off" disabled="disabled">
					  						Color scale</input>
											<form id="efg_label_type">
												&nbsp <input type="radio" name="efg_ltype" id="efg_ltype_1" 
												title="Vzz as electric gradient"
												value="0" autocomplete="off" onclick="efg_radio_handler(event)" disabled="disabled" checked>V<sub>zz</sub> (<span style="color: rgb(0, 128, 255)">au</span>)</input> <br> 
												&nbsp <input type="radio" name="efg_ltype" id="efg_ltype_2"
												title="Anisotropy, defined as Vzz-(Vxx+Vyy)/2"
												value="1" autocomplete="off" onclick="efg_radio_handler(event)" disabled="disabled"><span id="efg_par_1">Anisotropy</span> (<span style="color: rgb(0, 128, 255)">au</span>)</input> <br>
												&nbsp <input type="radio" name="efg_ltype" id="efg_ltype_3"
												title="Asymmetry, defined as (Vyy-Vxx)/Vzz"
												value="2" autocomplete="off" onclick="efg_radio_handler(event)" disabled="disabled"><span id="efg_par_2">Asymmetry</span> </input> <br>
												&nbsp <input type="radio" name="efg_ltype" id="efg_ltype_4"
												title="Quadrupolar constant, directly proportional to Vzz and dependent on the quadrupolar moment of the isotope considered"
												value="3" autocomplete="off" onclick="efg_radio_handler(event)" disabled="disabled">Quadrupolar constant (<span id="q_units" style="color: rgb(0, 128, 255)">MHz</span>)</input> <br>
											</form>
					  			</div>
					  			</div>
					  			</div>
					  	
								<h3  id="isc_head" class="head">Visualize indirect spin-spin coupling</h3>					
								<div>						
								<script type="text/javascript" src="files/isc.js"></script>
								Component:
								<select id="isc_drop" onchange="isc_drop_handler(event)" disabled="disabled">
					  							<option value="isc">isc</option>
					  			</select>
					  			
								<div id="isc_graph_div" class="ctrl_left">
											<input type="checkbox" id="isc_check"
											title="Visualize numerical values for the isotropic value of the J coupling."
											onchange="isc_label_handler(event)" autocomplete="off" disabled="disabled">
											Labels (isotropic coupling, Hz, <span style="color: rgb(128, 255, 0)">positive</span> or <span style="color: rgb(255, 0, 128)">negative</span>)</input>
								
											<br><br>

		
								<div id="isc_label_div" class="ctrl_right">
		
								</div>
								</div>
								Click on any atom to show its couplings with the rest of the selection (the picking will not work when the selection is in "Custom" mode)							
								<br>
				  				Visualized range:
				  				<input type="text" id="isc_min" size="4" autocomplete="off" disabled="disabled" onchange="isc_minmax_handler()" value="0"
				  				title="Minimum value of the isotropic J-coupling to visualize"></input>
				  				-
				  				<input type="text" id="isc_max" size="4" autocomplete="off" disabled="disabled" onchange="isc_minmax_handler()" value="0"
				  				title="Maximum value of the isotropic J-coupling to visualize"></input>
				  												<span style="color: rgb(128, 255, 0)">Hz</span>
		
								</div>
							
							<h3  id="dip_head" class="head">Calculate dipolar couplings</h3>
							<div>
							<script type="text/javascript" src="files/dipolar.js"></script>
							
							<div id="dipolar_ctrl_left" class="ctrl_left">							
								
								<br>
								
								<input type="checkbox" id="dipolar_check" disabled="true" autocomplete = "off" onchange="dip_label_handler()"
								title="Visualize numerical values for the dipolar coupling with the given direction of the magnetic field">
								Labels (<span style="color: rgb(0, 230, 230)">kHz</span>)</input>							
								
								<br>
								<br>
							
							<div id="dipolar_ctrl_right" class="ctrl_right">

							<!--
							
							Commented out while waiting for Jmol to implement this

								<span title="Setting any of these three indices to a value different from zero will apply a static magnetic field to the sample, and the consequent dipolar couplings will be calculated keeping into account the angular dependency, (3cos&theta;-1)/2. If all three indices are zero, only the dipolar coupling constant will be calculated.">
								Static magnetic field (crystallographic direction, [0 0 0] = no field):<br>
								
								h: <input id="h_Hdir" type="text" maxlength="5" size="3" value="0" autocomplete="off" onkeypress="hkl_field_handler(event)"
		  						title="Crystallographic direction of the static field H - index h."></input>
		  						k: <input id="k_Hdir" type="text" maxlength="5" size="3" value="0" autocomplete="off" onkeypress="hkl_field_handler(event)"
		  						title="Crystallographic direction of the static field H - index k"></input>
		  						l: <input id="l_Hdir" type="text" maxlength="5" size="3" value="0" autocomplete="off" onkeypress="hkl_field_handler(event)"
		  						title="Crystallographic direction of the static field H - index l"></input>
		  						</span>							
							-->

							</div>							
							</div>
							Click on any atom to show its couplings with the rest of the selection (the picking will not work when the selection is in "Custom" mode).<br>
							Cutoff distance: 
							<input type="text" id="vvleck_r" maxlength="4" size="4" value="1.0" autocomplete="off" disabled="true" onkeypress="vvleck_r_handler(event)"
							title="Cutoff distance from selected atom for computation of RMS dipolar coupling"></input> &Aring;
							<input type="checkbox" id="vvleck_sphere_check" autocomplete="off" disabled="true" onchange="vvleck_sphere_handler()"> Visualize range sphere
							<br>
							<br>
							<br>
							Evaluate root square sum dipolar coupling:
							<br>								
							<div class="ctrl_left">
							<input type="button" id="vvleck_iso_eval" value="Isonuclear RSS coupling" disabled="true" autocomplete="off" onclick="vvleck_eval(true)"></input>
							<div class="ctrl_right">
							<input type="button" id="vvleck_tot_eval" value="Total RSS coupling" disabled="true" autocomplete="off" onclick="vvleck_eval(false)"></input>
							</div>
							</div>
							</div>					

							<h3 id="eul_head" class="head">Euler angles rotations</h3>
							<div>
							Calculate Euler angle rotations between tensors. Use a left click to select atom 1, and a right click to select atom 2:<br><br>
							<div class="ctrl_left">

							<form id="atom1_eul_type">
								Atom 1:<br>
								<input type="radio" name="eultype1" id="eultype1_ms"  value="ms"  autocomplete="off" onclick="euler_diff_calc_handler()" disabled="true"checked>Magnetic shielding<br>
								<input type="radio" name="eultype1" id="eultype1_efg" value="efg" autocomplete="off" onclick="euler_diff_calc_handler()" disabled="true">Electric field gradient
							</form>
							<br>
							<input type="button" id="euldiff_butt" value="Euler angle difference" onclick="euldiff_butt_handler()"
							title="Shows the rotation, as Euler angles, between the tensors of the chosen type on the selected atoms. The default convention is the ZYZ one. To change the convention in use, go to the Options tab.">

							<div class="ctrl_right">

							<form id="atom2_eul_type">
								Atom 2:<br>
								<input type="radio" name="eultype2" id="eultype2_ms"  value="ms"  autocomplete="off" onclick="euler_diff_calc_handler()" disabled="true"checked>Magnetic shielding<br>
								<input type="radio" name="eultype2" id="eultype2_efg" value="efg" autocomplete="off" onclick="euler_diff_calc_handler()" disabled="true">Electric field gradient
							</form>

							</div>
							</div>
							<br>
							Table of rotations from <span style="color: rgb(255, 128, 0)">ms</span> to <span style="color: rgb(0, 128, 255)">efg</span> tensors on the same atom:
							<br>
							<div class="ctrl_left">
							<input type="button" id="eultab_butt" onclick="eultab_calculate()" value="Generate table" disabled="true">
							<div class="ctrl_right">
							<input type="checkbox" id="eultab_check" autocomplete="off">Output in a new tab
							</div>
							</div>
							</div>					


					</div>
					
					<div id="file_gen">
					
					<script type="text/javascript" src="files/output.js"></script>
					
					<div id="file_type_div" class="ctrl_left">
					File type: <select id="file_type_drop" autocomplete="off" onchange="file_type_drop_handler()"
					title="Select the desired file output type. Overview = a readable format for data summarizing - Tabulated = a data summary designed for parsing with Excel or Origin - JSON = formatted data for use by the json_tosim.py script">
						<option value="recap">Overview</option>
						<option value="table">Tabulated</option>
						<option value="json">JSON</option>
					</select>
					<div id="file_btn_div" class="ctrl_right">
						<input type="button" value="Generate" onclick="output_file_gen()"></input>
					</div>
					</div>
					<br>
					<div class="ctrl_left">
					Target software: <select id="soft_targ_drop" autocomplete="off" disabled="disabled"
					title="Select the simulation software you want to use with your data - json_to_sim.py will create the appropriate files">
						<option value="simpson">SIMPSON</option>
						<option value="spinev">SPINEVOLUTION</option>
					</select>
					<br>
					<div class="ctrl_right">
					<input type="checkbox" id="file_newtab_check" autocomplete="off"
					title="Output the content in a new tab instead of saving it as a file">Output in a new tab </input>
					<br><br>
					<a id="file_download" href="" class="hidden" target="_blank" download="">Download</a>
					</div>
					</div>
					Atoms: <select id="sel_file_drop" autocomplete="off" disabled="disabled" onchange="sel_file_drop_handler()">
						<option value="all">All atoms</option>
						<option value="sel">Only selected</option>
						<option value="range">All atoms within</option>
						<option value="sel_range">All selected atoms within</option>
					</select>

					<div id="range_file_div" style="visibility:hidden">
					<input type="text" id="range_file_r" maxlength="4" size="4" value="1.0" autocomplete="off" disabled="true" onkeypress="range_file_r_handler(event)"
					title="Maximum distance from selected atom of nuclei to include"></input> &Aring; of <span id="range_atom_picked">N/A</span>
					&nbsp;
					<input type="checkbox" id="range_sphere_check" checked="true" autocomplete="off" disabled="true" onchange="range_sphere_handler()"> Visualize range sphere
					</div>

					<br>
					Include:
					<div class="ctrl_left">
					<input type="checkbox" id="ms_file_check" autocomplete="off" disabled="disabled">Magnetic shielding</input>
					(with reference: <input type="text" id="ms_file_ref" size = "5" autocomplete="off" value="N/A" disabled="disabled"></input> ppm)
					<br>
					<input type="checkbox" id="dip_file_check" autocomplete="off" disabled="disabled">Dipolar interactions</input>
					<div class="ctrl_right">
					<input type="checkbox" id="efg_file_check" autocomplete="off" disabled="disabled">Quadrupolar constants</input>
					<br>
					<input type="checkbox" id="isc_file_check" autocomplete="off" disabled="disabled">Indirect spin-spin coupling</input>
					</div>
					</div>
					
					</div>
					
					<div id="options_accordion">
					
					<!--

					Removed because unnecessary after implementation of centroids. Will be re-inserted if needed/asked

					<h3 class="head">Shift molecule</h3>
					<div>
					<div class="ctrl_left">
						Shift<br> 
						a: <input type="text" id="opt_a_shift" maxlength="3" size="3" value="0" autocomplete="off"
						title="Insert desired shift along the a unit cell direction in percent"></input>%
						b: <input type="text" id="opt_b_shift" maxlength="3" size="3" value="0" autocomplete="off"
						title="Insert desired shift along the b unit cell direction in percent"></input>%
						c: <input type="text" id="opt_c_shift" maxlength="3" size="3" value="0" autocomplete="off"
						title="Insert desired shift along the c unit cell direction axis in percent"></input>%
					<div class="ctrl_right" style="text-align:center">
						<br>
						<input type="button" id="opt_btn_shift" value="Apply shift" onclick="shift_btn_handler()"
						title="Shift all the atoms in the model of the percentage of the unit cell base vectors indicated. Will reset all plots and selections."></input>
					</div>
					</div>
					</div>
					-->	

					<h3 class="head">Plotting options</h3>
					<div>
						Ellipsoid translucency (0 = solid, 1 = invisible): <input type="text" id="opt_transl" maxlength="4" size="4" value="0.5" autocomplete="off"
						title="Insert value desired for ellipsoid translucency" onkeypress="opt_transl_handler(event)" onchange="opt_transl_handler(event)"></input>
						<br>
						Ellipsoid type: <select id="opt_type" autocomplete="off"
						title="Choose the type of visualization for ellipsoids. Can speed up rendering when using JSmol (Filled = slower, Axes Only = faster)."
						onchange="opt_type_handler(event)">
						  <option value="fill">Filled</option>
						  <option value="axearcs">Axes and arcs</option>
						  <option value="axes">Axes Only</option>
						</select>
						<br>
						ISC graph thickness (0.4 = default): <input type="text" id="opt_width" maxlength="4" size="4" value="0.4" autocomplete="off"
						title="Insert value desired for ISC graph line thickness" onkeypress="opt_width_handler(event)" onchange="opt_width_handler(event)"></input>			
					</div>

					<h3 class="head">Euler angles</h3>
					<div>
					Convention: <select id="opt_euler_drop"
					title="Choose here the convention you want to be used for the calculation of Euler angle differences. This will have no effect on the output to simulation programs">
						<option value="zyz">Rose (ZYZ)</option>
						<option value="zxz">Goldstein(ZXZ)</option>
					</select>
					</div>
					
					<h3 class="head">Units and conventions</h3>
					<div>
					Quadrupolar constants: <select id="q_units_choice"
					title="Choose here the units to be used in quadrupolar constant labels"
					onchange="q_units_choice_handler(event)">
						<option value="MHz">MHz</option>
						<option value="kHz">kHz</option>
					</select>
					<br><br>
					Tensor conventions: <select id="t_conv_choice"
					title="Choose the convention you prefer for tensor representation"
					onchange="t_conv_choice_handler(event)" autocomplete="off">
						<option value="haeb">Haeberlen</option>
						<option value="herber">Herzfeld-Berger</option>
					</select>
					</div>
					
					<h3 class="head">Save snapshot</h3>
					<div>
					W:     <input type="text" id="snap_w" autocomplete="off" maxlength="4" size="4" value="800" title="Width (pixels) of snapshot"></input> &nbsp; &nbsp;
					H:     <input type="text" id="snap_h" autocomplete="off" maxlength="4" size="4" value="600" title="Height (pixels) of snapshot"></input> <br><br>
					&nbsp; <input type="button" id="snap_button" onclick="snap_handler()" value="Save snapshot"></input>
					<br><br>
					<a id="snap_download" href="" class="hidden" target="_blank" download="">Download</a>
					</div>

					</div>
			</div>
			
			<div id="euler_popup" title="Euler angles" class="popupdiv">
				This is just a popup test. &alpha;, &beta;, &gamma;.
			</div>
			
			<div id="vvleck_popup" title="Van Vleck second moment" class="popupdiv">
				This is just a popup test. &alpha;, &beta;, &gamma;.
			</div>

  </div>
  </div>  
  <div class="creditdiv" id="credit_div">
  <script type="text/javascript" >
		//Like for the title, this font size needs to be estimated from the window size
		//Resize console as well to avoid superposition
		
		$(document).ready( function() {
		  $("#jmol_console").attr("size",Math.ceil(winW*0.6/9));
		  $("#credit_div").css("fontSize", Math.ceil(winH/70.0) + "px");
		  $("#jmol_div").html(Jmol.getAppletHtml("mainJmol",main_info));
		  
		  switch_handler(false);
		  
		  hover_load();
		  
		});
  </script>  
  
  A CCP-NC project by Simone Sturniolo
  <br>
  Copyright (C) 2013 Science and Technology Facility Council
  <br>
  Distributed under the GNU General Public License
  </div>
  </body>
</html>
